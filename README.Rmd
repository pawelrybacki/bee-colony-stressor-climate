---
title: "Combine Data on Bee Colony Stressors and Climate"
author: "Paweł Rybacki"
date: '2022-04-22'
output: md_document
---

This file was originally a part of a team project whose goal was to establish relationships among variables related to bee colony losses, bee colony stressors, and climate. 

The data describing bee colonies come from the Bee Colonies dataset from [TidyTuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2022/2022-01-11/readme.md#bee-colonies). This source has two datasets – related to colonies and stressors. The stressor dataset has 5 variables and 7,332 observations. Here are the explanations of variables in these two subsets:

| Variable   | Class     | Description                                                                                                                             |
|------------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------|
| year       | character | Year                                                                                                                                    |
| months     | character | Month range                                                                                                                             |
| state      | character | State Name (note there is United States and Other States)                                                                               |
| stressor   | character | Stress type                                                                                                                             |
| stress_pct | double    | Percent of colonies affected by stressors anytime during the quarter, colony can be affected by multiple stressors during same quarter |

This file uses the TidyTuesday Bee Colonies stressors dataset and downloads data on climate from the National Climatic Data Center using API through the `rnoaa` package, an R interface to NOAA climate data.

More specifically, this script uses `rnoaa` to download, transform, and merge data so that the temperature, precipitation, and bee colony stressor types and effects for all 50 states (if applicable) and all quarters of the years 2015-2021 are present in one final dataset called `stressor_climate.csv`. 

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

```{r install-libraries, include = FALSE}
# install if necessary
# install.packages("rnoaa", "tidyverse", "doBy", "lubridate")
library(tidyverse)
library(rnoaa)
library(doBy)
library(lubridate)

#https://stackoverflow.com/questions/66656313/downloading-noaa-data
noaakey <- Sys.getenv("NOAA_KEY")
stressor <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-11/stressor.csv')
```

## About the use of the `rnoaa` package

To use some components of the package, including the ones related to this project, the user must get an API key (aka, token) from https://www.ncdc.noaa.gov/cdo-web/token. The token must be passed in some API requests (functions of the packages) as an argument. Rather than hard-coding the token, it's safer to pass it as a variable stored in:

a) your .Rprofile file with the entry options(noaakey = "your-noaa-token"), or

b) your .Renviron file with the entry NOAA_KEY=your-noaa-token

